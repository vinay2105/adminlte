{% extends "base.html" %}
{% block title %}Invoice {{ invoice.id }}{% endblock %}
{% block content %}

<style>
.card{background:#111827;border-radius:14px;padding:20px;margin-bottom:20px}
.row{display:flex;justify-content:space-between;align-items:flex-start;gap:20px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px 12px;text-align:left}
th{font-size:11px;color:#9ca3af;letter-spacing:.05em}
tr{border-bottom:1px solid #1f2937}
.money{font-weight:600}
.btn{padding:8px 14px;border-radius:6px;font-size:13px;background:#3b82f6;color:#fff;border:0;cursor:pointer}
input{background:#1f2937;border:1px solid #374151;color:#e5e7eb;padding:8px;border-radius:6px}
.split{display:grid;grid-template-columns:1fr 1fr;gap:20px}

.scroll{max-height:520px;overflow-y:auto}
.scroll::-webkit-scrollbar{width:6px}
.scroll::-webkit-scrollbar-thumb{background:#374151;border-radius:6px}
.head{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.icon{width:34px;height:34px;border-radius:8px;background:#1f2937;display:flex;align-items:center;justify-content:center}
.print{background:#1f2937;border:1px solid #374151}
</style>

<!-- HEADER -->
<div class="card">
  <div class="row">
    <div>
      <div style="display:flex;align-items:center;gap:10px">
        <div class="icon">ðŸ§¾</div>
        <h2>Invoice #{{ invoice.id }}</h2>
      </div>
      <div>{{ invoice.customer.name }}</div>
      <div>{{ invoice.from_date }} â†’ {{ invoice.to_date }}</div>
    </div>
    <div style="text-align:right">
      <div>Total: <b>â‚¹{{ invoice.total_amount }}</b></div>
      <div>Paid: <b>â‚¹{{ paid }}</b></div>
      <div>Pending: <b>â‚¹{{ pending }}</b></div>
      <a href="{% url 'print_invoice' invoice.id %}" target="_blank">
  <button class="btn print" style="margin-top:10px">
    Print Invoice
  </button>
</a>

    </div>
  </div>
</div>

<!-- SPLIT -->
<div class="split">

  <!-- DELIVERIES -->
  <div class="card scroll">
    <div class="head">
      <b>Billed Deliveries</b>
      <span style="font-size:12px;color:#9ca3af">{{ deliveries|length }}</span>
    </div>
    <table>
      <thead>
        <tr><th>DATE</th><th>NEWSPAPER</th><th>PRICE</th></tr>
      </thead>
      <tbody>
        {% for row in deliveries %}
        <tr>
          <td>{{ row.delivery.date }}</td>
          <td>{{ row.delivery.newspaper.name }}</td>
          <td class="money">â‚¹{{ row.delivery_price }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- PAYMENTS -->
  <div class="card scroll">
    <div class="head"><b>Payments</b></div>

    {% if pending > 0 %}
    <form method="post" action="{% url 'generate_payment' invoice.id %}" style="margin-bottom:12px">
      {% csrf_token %}
      <div style="display:flex;gap:8px;">
        <input type="number" step="0.01" name="amount" placeholder="Amount" required>
        <input type="text" name="mode" placeholder="Mode" required>
        <button class="btn">Add</button>
      </div>
    </form>
    {% endif %}

    <table>
      <thead>
        <tr><th>DATE</th><th>AMOUNT</th><th>MODE</th></tr>
      </thead>
      <tbody>
        {% for p in payments %}
        <tr>
          <td>{{ p.payment_date }}</td>
          <td class="money">â‚¹{{ p.amount }}</td>
          <td>{{ p.mode }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="3">No payments yet</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>

{% endblock %}

